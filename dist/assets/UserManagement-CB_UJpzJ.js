import{j as e,p as s,ap as a,y as l,ay as r,a8 as t,as as i,av as n}from"./ui-vendor-BwAhdcts.js";import{r as c}from"./router-vendor-xnFU-SGQ.js";import{C as d,a as x,b as m,c as o,B as h,A as j,p as u}from"./index-CImf8UwA.js";import{B as p}from"./badge-Def1q0WS.js";import{I as v}from"./input-B1kw1Jk2.js";import{S as g,a as N,b as f,c as y,d as w}from"./select-DdYKYt_5.js";import{T as b,a as S,b as _,c as A,d as C,e as L}from"./table-DUY_Eslo.js";import{A as U}from"./AdminNavigation-FwahpWK3.js";import{u as F}from"./useAdmin-B5LEeg7r.js";import{a as z}from"./adminService-BGlCEodP.js";import"./react-vendor-DEQ385Nk.js";import"./supabase-vendor-Bj79fh9f.js";import"./index-jVOyRz7F.js";import"./index-LkZ9e_wI.js";const D=()=>{const{isAdmin:D,isSuperAdmin:V}=F(),[I,R]=c.useState(""),[B,E]=c.useState("all"),[J,M]=c.useState("all"),[O,k]=c.useState([]),[P,T]=c.useState(!0),[W,X]=c.useState({page:1,limit:10,total:0});if(c.useEffect(()=>{D&&(async()=>{try{T(!0);const e={page:W.page,limit:W.limit};"all"!==B&&(e.role=B),"all"!==J&&(e.status=J);const s=await z.getUsers(e);k(s.users),X(e=>({...e,total:s.total}))}catch(e){}finally{T(!1)}})()},[D,W.page,W.limit,B,J,I]),!D)return null;const Y=e=>{switch(e){case"admin":case"super_admin":return"bg-purple-100 text-purple-800 border-purple-200";default:return"bg-green-100 text-green-800 border-green-200"}},q=O.filter(e=>{const s=e.full_name.toLowerCase().includes(I.toLowerCase())||e.email.toLowerCase().includes(I.toLowerCase()),a="all"===B||e.role===B,l="all"===J||"active"===J&&e.is_active||"inactive"===J&&!e.is_active;return s&&a&&l});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(U,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-24 md:pt-20",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"User Management"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Manage users, roles, and permissions"})]}),e.jsx(d,{className:"mb-6",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(v,{placeholder:"Search users...",value:I,onChange:e=>R(e.target.value),className:"pl-10"})]})}),e.jsxs(g,{value:B,onValueChange:E,children:[e.jsx(N,{className:"w-full sm:w-48",children:e.jsx(f,{placeholder:"Filter by role"})}),e.jsxs(y,{children:[e.jsx(w,{value:"all",children:"All Roles"}),e.jsx(w,{value:"student",children:"Student"}),e.jsx(w,{value:"admin",children:"Admin"}),e.jsx(w,{value:"super_admin",children:"Super Admin"})]})]}),e.jsxs(g,{value:J,onValueChange:M,children:[e.jsx(N,{className:"w-full sm:w-48",children:e.jsx(f,{placeholder:"Filter by status"})}),e.jsxs(y,{children:[e.jsx(w,{value:"all",children:"All Status"}),e.jsx(w,{value:"active",children:"Active"}),e.jsx(w,{value:"inactive",children:"Inactive"})]})]})]})})}),e.jsxs(d,{children:[e.jsx(m,{children:e.jsxs(o,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Users (",q.length,")"]}),e.jsxs(h,{children:[e.jsx(a,{className:"h-4 w-4 mr-2"}),"Add User"]})]})}),e.jsx(x,{children:P?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"text-gray-500",children:"Loading users..."})}):0===q.length?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No users found"}):e.jsxs(b,{children:[e.jsx(S,{children:e.jsxs(_,{children:[e.jsx(A,{children:"User"}),e.jsx(A,{children:"Role"}),e.jsx(A,{children:"Status"}),e.jsx(A,{children:"Joined"}),e.jsx(A,{children:"Last Login"}),e.jsx(A,{children:"Actions"})]})}),e.jsx(C,{children:q.map(s=>{return e.jsxs(_,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(j,{className:"h-8 w-8",children:e.jsx(u,{className:"bg-blue-100 text-blue-600",children:(c=s.full_name,c.split(" ").map(e=>e[0]).join("").toUpperCase())})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.full_name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})]})}),e.jsx(L,{children:V?e.jsxs(g,{value:s.role,onValueChange:e=>(async(e,s)=>{if(V)try{await z.updateUserRole(e,s),k(O.map(a=>a.id===e?{...a,role:s}:a))}catch(a){alert("Failed to update user role")}else alert("Only super admin can change user roles")})(s.id,e),children:[e.jsx(N,{className:"w-32",children:e.jsx(f,{})}),e.jsxs(y,{children:[e.jsx(w,{value:"student",children:"Student"}),e.jsx(w,{value:"admin",children:"Admin"}),e.jsx(w,{value:"super_admin",children:"Super Admin"})]})]}):e.jsx(p,{className:Y(s.role),children:s.role.replace("_"," ").toUpperCase()})}),e.jsx(L,{children:e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>(async(e,s)=>{try{await z.updateUserStatus(e,s),k(O.map(a=>a.id===e?{...a,is_active:s}:a))}catch(a){alert("Failed to update user status")}})(s.id,!s.is_active),className:(a=s.is_active,a?"bg-green-100 text-green-800":"bg-red-100 text-red-800")+" hover:opacity-80",children:s.is_active?e.jsxs(e.Fragment,{children:[e.jsx(l,{className:"h-3 w-3 mr-1"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"h-3 w-3 mr-1"}),"Inactive"]})})}),e.jsx(L,{className:"text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString()}),e.jsx(L,{className:"text-sm text-gray-500",children:s.last_login_at?new Date(s.last_login_at).toLocaleDateString():"Never"}),e.jsx(L,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{variant:"ghost",size:"sm",children:e.jsx(t,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"sm",children:e.jsx(i,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700",children:e.jsx(n,{className:"h-4 w-4"})})]})})]},s.id);var a,c})})]})})]})]})]})};export{D as default};
//# sourceMappingURL=UserManagement-CB_UJpzJ.js.map
